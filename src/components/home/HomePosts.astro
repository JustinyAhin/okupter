---
// Internal
import getDataFromDato from "../../assets/scripts/client";
import { homeIndexQuery } from "../../assets/scripts/queries";

// Components import
import HomePostPreview from "./HomePostPreview.astro";

// Utils
import { readableDate } from "../../assets/scripts/utils";

// Data
let { allPosts } = await getDataFromDato(homeIndexQuery);

allPosts = allPosts.map((post) => {
  return {
    ...post,
    _firstPublishedAt: readableDate(post._firstPublishedAt),
    seoMetatags: post.seoMetatags
      ? post.seoMetatags
      : {
          title: post.title,
          description: post.title,
          image: {
            url: "https://www.datocms-assets.com/66491/1651977048-okupter-og-image.png",
            alt: "Okupter default OG image",
          },
        },
  };
});
---

<Fragment>
    {
        allPosts.map((post) => {
            return (
                <HomePostPreview slug={post.slug} title={post.title} date={post._firstPublishedAt}/>
            )
        })
    }
</Fragment>